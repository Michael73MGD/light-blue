<!doctype html>

<!-- IMPORTS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


<html lang="en">
<head>
  <title>Bootstrap 4 Website Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" href="/resources/demos/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <style>
  .fakeimg {
    height: 500px;
    background: #aaa;
  }
  </style>
</head>
<body>

<div class="jumbotron text-center" style="margin-bottom:0">
  <h1><b>Chester: an AI-Powered, Robot-controlled Chess Robot</b></h1>
  <p>By <i>Light Blue</i></p> 
</div>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <div style="width:19.5%">

  </div>
  <a class="navbar-brand" href="#">Home</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/Michael73MGD/light-blue">Github</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Devpost</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Video Submission</a>
      </li>    
    </ul>
  </div>  
</nav>

<div class="container" style="margin-top:30px">
  <div class="row">
    <div class="col-sm-7">
      <h2>Live Camera Feed:</h2>
      <div style = "">
        <img src = "http://192.168.1.34:8000/stream.mjpg">
      </div>
      <h3 style = "padding-top: 10px;">Game Options:</h3>
      <ul class="nav nav-pills flex-column">
        <li class="nav-item">
          <a id = "resetButton" class="nav-link active" href="#">Reset Game</a>
      

        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Something Else</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Something Else Again Lol</a>
        </li>
      </ul>
      <hr class="d-sm-none">
    </div>
    <div class="col-sm-5">
		<div>
			<h2>Interactive Chess Board</h2>
			<h5>Drag and drop to move pieces</h5>
        </div>
		<div id = "board" >
			<!-- Board and init peice locations -->
			<img style = "width:100%" draggable='false' src = "static/board.png">
				<!--
				<img  						draggable = "true"  id = "test" 		style = "width:50px;				position: absolute;	TOP:300px; 	LEFT:200px" 	src = "static/B_rook.png">
				-->
				<!-- Row One -->
				<img  class="draggable"		draggable = "true"  id = "B_rook_L" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:40px" 		src = "static/B_rook.png">
				<img  class="draggable" 	draggable = "true" 	id = "B_knight_L" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:90px" 		src = "static/B_knight.png">
				<img  class="draggable" 	draggable = "true" 	id = "B_bishop_L" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:141px" 	src = "static/B_bishop.png">	
				<img  class="draggable" 	draggable = "true" 	id = "B_queen"	 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:191px" 	src = "static/B_queen.png">		
				<img  class="draggable" 	draggable = "true" 	id = "B_king" 		style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:242px" 	src = "static/B_king.png">		
				<img  class="draggable" 	draggable = "true" 	id = "B_bishop_R" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:292px" 	src = "static/B_bishop.png">	
				<img  class="draggable" 	draggable = "true" 	id = "B_knight_R" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:343px" 	src = "static/B_knight.png">
				<img  class="draggable" 	draggable = "true" 	id = "B_rook_R" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:394px" 	src = "static/B_rook.png">		
				
				<!-- Row Two -->
				<img class="piece" 	id = "B_pawn_1" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:440px; 	LEFT:20px" 		src = "static/B_pawn.png">
				<img class="piece" 	id = "B_pawn_2" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:86px; 	LEFT:20px" 		src = "static/B_pawn.png">
				<img class="piece" 	id = "B_pawn_3" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:141px" 	src = "static/B_pawn.png">	
				<img class="piece" 	id = "B_pawn_4" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:191px" 	src = "static/B_pawn.png">		
				<img class="piece" 	id = "B_pawn_5" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:242px" 	src = "static/B_pawn.png">		
				<img class="piece" 	id = "B_pawn_6" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:292px" 	src = "static/B_pawn.png">	
				<img class="piece" 	id = "B_pawn_7" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:92px; 	LEFT:343px" 	src = "static/B_pawn.png">
				<img class="piece" 	id = "B_pawn_8" 	style = "cursor:grab; width:50px;	position: absolute;	TOP:444px; 	LEFT:394px" 	src = "static/B_pawn.png">	
				
			
			<!--
			<div id="target" ondrop="drop_handler(event)" ondragover="dragover_handler(event)" style = "position:absolute; width:51px;height:51px; TOP:146px; 	LEFT:40px"><b>DROP ZONE</b></div>
			
			<div id="target2" ondrop="drop_handler(event)" ondragover="dragover_handler(event)" style = "position:absolute; width:40px;height:40px; TOP:150px; 	LEFT:200px"><b>DROP ZONE</b></div>
			-->
		</div>
		<div style = "display:none">
      <p>Some text..</p>
      <br>
      <h2>AI Classifier Cam:</h2>
      <h5>Look at him go!</h5>
      <div class="fakeimg">Fake Image</div>
      <p>Chester is very smart. He uses OpenCV to see the chess peices and uses Stockfish to compute the next best move. Better play smart! He's set to hard mode :)</p> 
    </div>
    <div id = 'terminal'>
      <h2>Program Output
      <hr>
    </div>
  </div>
</div>

<div class="jumbotron text-center" style="margin-bottom:0">
  <p> :) Thanks for playing! </p>
</div>

</body>
</html>


  <!-- Script time -->
  <script>



    document.getElementById('resetButton').onclick = resetGame;
	
    function resetGame() {
      alert("Reset request sent!");
      return false;
    };

    terminal = document.getElementById('terminal');
    function new_message(){
      var paragraph = document.createElement('p');
      var message = document.createTextNode('testy mesty');
      paragraph.appendChild(message);
      terminal.appendChild(paragraph);
    };
    //new_message();
    
	
	
	//-------------------------------------------------------init board positions-------------------------------------------------------
	
	// coordinates of TOP LEFT (x, y) == 30, 86
	// coordinates of BOTTOM RIGHT (x, y) == 387, 440
	function mid(a, b) {
		return (a + b) / 2
	};
	
	// horizontal
	var a = 30
	var b = 387
	var c = mid(a, b)
	var d = mid(a, c)
	var e = mid(a, d)
	var f = mid(d, c)
	var g = mid(c, b)
	var h = mid(c, g)
	var i = mid(g, b)
	
	// vertical
	var a2 = 86
	var b2 = 440
	var c2 = mid(a2, b2)
	var d2 = mid(a2, c2)
	var e2 = mid(a2, d2)
	var f2 = mid(d2, c2)
	var g2 = mid(c2, b2)
	var h2 = mid(c2, g2)
	var i2 = mid(g2, b2)
	
	var positionsPreX = [a, e, d, f, c, h, g, i, b];
	var positionsX = [0, 0, 0, 0, 0, 0, 0, 0];
	console.log("X POSITIONS:");
	for (var i = 0; i < positionsPreX.length-1; i++) {
		positionsX[i] = normalizeX(positionsPreX[i]);
		console.log(positionsX[i]);
	}
	
	var positionsPreY = [a2, e2, d2, f2, c2, h2, g2, i2, b2];
	var positionsY = [0, 0, 0, 0, 0, 0, 0, 0];
	console.log("Y POSITIONS:");
	for (var i = 0; i < positionsPreY.length-1; i++) {
		positionsY[i] = normalizeY(positionsPreY[i]);
		console.log(positionsY[i]);
	}

	function normalizeX(coordinate) {
		var scalar = 1.14;
		var shift = 5;
		return coordinate * scalar + shift;
	}
	
	function normalizeY(coordinate) {
		var scalar = 1.12;
		var shift = 0;
		return coordinate * scalar + shift;
	}

	var specialBlackIDs = ["B_rook_L", "B_knight_L", "B_bishop_L", "B_queen", "B_king", "B_bishop_R", "B_knight_R", "B_rook_R"];
	for (var i = 0; i < specialBlackIDs.length; i++) {
		chessboardInit(specialBlackIDs[i], positionsX[i], positionsY[0], 1);
	}
	
	var pawnBlackIDs = ["B_pawn_1", "B_pawn_2", "B_pawn_3", "B_pawn_4", "B_pawn_5", "B_pawn_6", "B_pawn_7", "B_pawn_8"];
	for (var i = 0; i < pawnBlackIDs.length; i++) {
		chessboardInit(pawnBlackIDs[i], positionsX[i], positionsY[1], 0);
	}

	function chessboardInit(divName, Xposition, Yposition, firstRow) {
		if (firstRow == 1) {
			//console.log("converting: " + divName + " " + positionsX[i]);
			var posx = Math.ceil(Xposition).toFixed();
			var posy = Math.ceil(Yposition).toFixed();
			var div = document.getElementById(divName);
			var strPosX = posx + "px";
			var strPosY = posy + "px";
			div.style.left = strPosX;
			div.style.top = strPosY;
			div.style.zIndex = 2;
		}
		else {
			//console.log("converting: " + divName + " " + positionsX[i]);
			var posx = Math.ceil(Xposition).toFixed();
			var posy = Math.ceil(Yposition).toFixed();
			var div = document.getElementById(divName);
			var strPosX = posx + "px";
			var strPosY = posy + "px";
			div.style.left = strPosX;
			div.style.top = strPosY;
			div.style.zIndex = 2;
		}
	}
	
	//-------------------------------------------------------END OF init board positions-------------------------------------------------------

	//-------------------------------------------------------Setting possible move squares-------------------------------------------------------

	//TOP:146px; 	LEFT:40px
	//ondrop="drop_handler(event)" ondragover="dragover_handler(event)"
	
	var totalDivsCounter = 0;
	for (var i = 0; i < positionsY.length; i++) {
	
		for (var j = 0; j < positionsX.length; j++) {
		
			var divName = divNameGenerator(totalDivsCounter);
			totalDivsCounter = totalDivsCounter + 1;
			console.log(divName);
			possibleMovesInit(divName, positionsX[j], positionsY[i]);
		
		}
	
	}
	totalDivsCounter = 0;
	
	function divNameGenerator(totalDivsCounter) {
		var str = "divStack";
		var newStr = str + totalDivsCounter;
		return newStr;
	}
	
	// initializes all divs meant to handle 
	function possibleMovesInit(divName, Xposition, Yposition) {
		//console.log("converting: " + divName + " " + positionsX[i]);
		var posx = Math.ceil(Xposition).toFixed();
		var posy = Math.ceil(Yposition).toFixed();
		var strPosX = posx + "px";
		var strPosY = posy + "px";
		createDiv(divName, strPosX, strPosY);
	}
	
	//createDiv("meme", "40px", "146px");
	// takes in a name for the div, to be procedurally generrated.
	// they will be labeled in the following way:
	//	1 2 3
	//  4 5 6
	//	7 8 9
	function createDiv(divName, xPosition, yPosition) {
		var div = document.createElement("div");
		//div.innerHTML = "<b>DROP</b>";
		div.id = divName;
		div.style.position = "absolute";
		div.style.width = "51px";
		div.style.height = "51px";
		div.style.top = yPosition;
		div.style.left = xPosition;
		div.style.zIndex = 1;
		div.setAttribute("ondrop", "drop_handler(event)"); 
		div.setAttribute("ondragover", "dragover_handler(event)"); 

		document.getElementById("board").appendChild(div);
	}
	
	//-------------------------------------------------------END OF Setting possible move squares-------------------------------------------------------
	
	//-------------------------------------------------------Finding and encoding the board starting position-------------------------------------------------------

	function dragover_handler(ev) {
		ev.preventDefault();
		ev.dataTransfer.dropEffect = "move";
	}
	function drop_handler(ev) {
		ev.preventDefault();
		// Get the id of the target and add the moved element to the target's DOM
		const data = ev.dataTransfer.getData("text/plain");
		console.log(ev.target)
		moveDiv = document.getElementById(data)
		originCoordX = moveDiv.style.left;
		originCoordY = moveDiv.style.top;
		console.log("Original X: " + originCoordX + " Original Y: " + originCoordY);
		moveDiv.style = 'width:50px'
		ev.target.appendChild(moveDiv);
		endCoordX = ev.target.style.left;
		endCoordY = ev.target.style.top;
		console.log("New X: " + endCoordX + " New Y: " + endCoordY);
	}

	function dragstart_handler(ev) {
		// Add the target element's id to the data transfer object
		ev.dataTransfer.setData("text/plain", ev.target.id);
		ev.dataTransfer.setData("text/html", ev.target.outerHTML);
		ev.dataTransfer.setData("text/uri-list", ev.target.ownerDocument.location.href);
	}

	window.addEventListener('DOMContentLoaded', () => {
		// Get the element by id
		// All special black pieces.
		const B_rook_L = document.getElementById("B_rook_L");
		const B_knight_L = document.getElementById("B_knight_L");
		const B_bishop_L = document.getElementById("B_bishop_L");
		const B_queen = document.getElementById("B_queen");
		const B_king = document.getElementById("B_king");
		const B_bishop_R = document.getElementById("B_bishop_R");
		const B_knight_R = document.getElementById("B_knight_R");
		const B_rook_R = document.getElementById("B_rook_R");
		
		// All black pawns.
		const B_pawn_1 = document.getElementById("B_pawn_1");
		const B_pawn_2 = document.getElementById("B_pawn_2");
		const B_pawn_3 = document.getElementById("B_pawn_3");
		const B_pawn_4 = document.getElementById("B_pawn_4");
		const B_pawn_5 = document.getElementById("B_pawn_5");
		const B_pawn_6 = document.getElementById("B_pawn_6");
		const B_pawn_7 = document.getElementById("B_pawn_7");
		const B_pawn_8 = document.getElementById("B_pawn_8");
		
		// Add the ondragstart event listener for special black pieces
		B_rook_L.addEventListener("dragstart", dragstart_handler);
		B_knight_L.addEventListener("dragstart", dragstart_handler);
		B_bishop_L.addEventListener("dragstart", dragstart_handler);
		B_queen.addEventListener("dragstart", dragstart_handler);
		B_king.addEventListener("dragstart", dragstart_handler);
		B_bishop_R.addEventListener("dragstart", dragstart_handler);
		B_knight_R.addEventListener("dragstart", dragstart_handler);
		B_rook_R.addEventListener("dragstart", dragstart_handler);
		
		// Add the ondragstart event listener for black pawns
		B_pawn_1.addEventListener("dragstart", dragstart_handler);
		B_pawn_2.addEventListener("dragstart", dragstart_handler);
		B_pawn_3.addEventListener("dragstart", dragstart_handler);
		B_pawn_4.addEventListener("dragstart", dragstart_handler);
		B_pawn_5.addEventListener("dragstart", dragstart_handler);
		B_pawn_6.addEventListener("dragstart", dragstart_handler);
		B_pawn_7.addEventListener("dragstart", dragstart_handler);
		B_pawn_8.addEventListener("dragstart", dragstart_handler);
		
	});
	
	//-------------------------------------------------------END OF Finding and encoding the board starting position-------------------------------------------------------

	fenStrOG = "rnPqkbnr/pppppppp/8/8/8/8/PPPPPPPb/RNBQKBNR";
	
	var tmp = fenStrOG.split('/');
	for (var i = 0; i < tmp.length; i++) {
	//	console.log(tmp[i].length);
	}
	
	printFen(fenStrOG);
	
	// traverses fen
	function printFen(fenStr) {
		
		fenLevels = fenStr.split('/');
		
		for (var rows = 0; rows < fenLevels.length; rows++) {
			//console.log(fenLevels[i]);
			for (var col = 0; col < fenLevels[rows].length; col++) {
			
				//console.log(fenLevels[rows].charAt(col));
				Map(rows, col, fenLevels[rows].charAt(col));
			
			}
			
			//console.log("NEW WORD!")
			
		}
		
	}
	
	var rCnt = 0;
	var nCnt = 0;
	var bCnt = 0;
	var pCnt = 0;
	
	// maps index position to board position for character.
	function Map(rows, col, letter) {
	
		//specialBlackIDs	all unique things
		//pawnBlackIDs		all uniqu pawns
		
		str = "divStack";
		id = 8 * rows + col;
		str = str + id;
		
		console.log(str + " Row: " + rows + " Col: " + col)
		
		if (letter == "r") {
			if (rCnt == 0) {
				tmp = document.getElementById(str);
				thing = document.getElementById("B_rook_L");
				thing.style = "width:51px";
				tmp.appendChild(thing);
				rCnt++;
				//console.log("rook moved to " + str)
			}
			else {
				tmp = document.getElementById(str);
				thing = document.getElementById("B_rook_R");
				thing.style = "width:51px";
				tmp.appendChild(thing);
			}
		}
		else if (letter == "n") {
			if (nCnt == 0) {
				tmp = document.getElementById(str);
				thing = document.getElementById("B_knight_L");
				thing.style = "width:51px";
				tmp.appendChild(thing);
				nCnt++;
			}
			else {
				tmp = document.getElementById(str);
				thing = document.getElementById("B_knight_R");
				thing.style = "width:51px";
				tmp.appendChild(thing);
			}
		}
		else if (letter == "b") {
			if (bCnt == 0) {
				tmp = document.getElementById(str);
				thing = document.getElementById("B_bishop_L");
				thing.style = "width:51px";
				tmp.appendChild(thing);
				bCnt++;
			}
			else {
				tmp = document.getElementById(str);
				thing = document.getElementById("B_bishop_R");
				thing.style = "width:51px";
				tmp.appendChild(thing);
			}
		}
		else if (letter == "q") {
			tmp = document.getElementById(str);
			thing = document.getElementById("B_queen");
			thing.style = "width:51px";
			tmp.appendChild(thing);
		}
		else if (letter == "k") {
			tmp = document.getElementById(str);
			thing = document.getElementById("B_king");
			thing.style = "width:51px";
			tmp.appendChild(thing);
		}
		else if (letter == "p") {
			if (pCnt == 0) {
				tmp = document.getElementById(str);
				thing = document.getElementById("B_pawn_1");
				thing.style = "width:51px";
				tmp.appendChild(thing);
			}
			
		}
	
	}
	
	var tmp = convertIndexToPixel(2, 0);
	console.log("X coord: " + tmp[1] + " Y coord: " + tmp[0]);
	
	// convert index to pixel values
	function convertIndexToPixel(rows, col) {
		
		var X = positionsX[col];
		var Y = positionsY[rows];
		
		var pixelPositionsYX = [];
		pixelPositionsYX[0] = Y;
		pixelPositionsYX[1] = X;
		
		return pixelPositionsYX;
		
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

  </script>